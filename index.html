<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker Celów Finansowych</title>
    <style>
        /* Previous CSS styles remain the same */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* ... rest of the CSS ... */
    </style>
</head>
<body>
    <!-- Previous HTML structure remains the same -->

    <script>
        // Initialize data
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let payments = JSON.parse(localStorage.getItem('payments')) || [];

        // Helper functions
        function formatCurrency(amount) {
            return parseFloat(amount).toFixed(2) + ' PLN';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Bez terminu';
            const date = new Date(dateString);
            return date.toLocaleDateString('pl-PL');
        }

        // Fixed addGoal function
        function addGoal() {
            const name = document.getElementById('goal-name').value.trim();
            const amountStr = document.getElementById('goal-amount').value;
            const amount = parseFloat(amountStr);
            const noDeadline = document.getElementById('no-deadline').checked;
            const deadline = noDeadline ? null : document.getElementById('goal-deadline').value;
            const monthlyPaymentStr = document.getElementById('goal-monthly-payment').value;
            const monthlyPayment = parseFloat(monthlyPaymentStr) || 0;

            // Validation
            if (!name) {
                alert('Wprowadź nazwę celu!');
                return;
            }
            if (!amountStr || isNaN(amount) || amount <= 0) {
                alert('Wprowadź poprawną kwotę docelową!');
                return;
            }

            const newGoal = {
                id: Date.now().toString(),
                name: name,
                targetAmount: amount,
                deadline: deadline,
                collected: 0,
                monthlyPayment: monthlyPayment
            };

            goals.push(newGoal);
            saveGoals();
            refreshGoalsList();

            // Reset form
            document.getElementById('goal-name').value = '';
            document.getElementById('goal-amount').value = '';
            document.getElementById('goal-deadline').value = '';
            document.getElementById('no-deadline').checked = false;
            document.getElementById('goal-monthly-payment').value = '';
            document.getElementById('goal-deadline').disabled = false;

            // Show confirmation
            alert('Cel został dodany pomyślnie!');
        }

        // Rest of the JavaScript functions remain the same
        function saveGoals() {
            localStorage.setItem('goals', JSON.stringify(goals));
        }

        function refreshGoalsList() {
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';

            goals.forEach((goal, index) => {
                const progress = calculateProgress(goal);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${goal.name}</td>
                    <td>${formatCurrency(goal.targetAmount)}</td>
                    <td class="mobile-hide">${formatDate(goal.deadline)}</td>
                    <td class="mobile-hide">${formatCurrency(goal.collected)}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        ${progress.toFixed(1)}%
                    </td>
                    <td class="mobile-hide">${formatCurrency(calculateMonthlyPayment(goal))}</td>
                    <td>
                        <button class="action-btn" onclick="editGoal(${index})">Edytuj</button>
                        <button class="action-btn delete-btn" onclick="deleteGoal(${index})">Usuń</button>
                    </td>
                `;
                goalsList.appendChild(row);
            });
        }

        // Initialize the application
        window.onload = function() {
            refreshGoalsList();
            refreshPaymentsList();

            // Set today's date as default for payment date
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('payment-date')) {
                document.getElementById('payment-date').value = today;
            }
        };
    </script>
</body>
</html>
